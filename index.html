<!doctype html>
<html lang="ms">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bahasa Melayu Pemulihan Khas</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .slide-in {
            animation: slideIn 0.4s ease-out;
        }

        .dragging {
            opacity: 0.5;
        }

        .drag-over {
            border-color: #10B981 !important;
            background-color: rgba(16, 185, 129, 0.1) !important;
            transform: scale(1.05);
        }

        .correct-drop {
            animation: correctAnim 0.5s ease;
        }

        .wrong-drop {
            animation: wrongAnim 0.5s ease;
        }

        @keyframes correctAnim {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); background-color: #10B981; }
            100% { transform: scale(1); }
        }

        @keyframes wrongAnim {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
            75% { transform: translateX(-10px); }
            100% { transform: translateX(0); }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="w-full min-h-full">
  <div id="app" class="w-full min-h-full"></div>
  <script>
        const defaultConfig = {
            background_color: "#FEF3C7",
            card_color: "#FFFFFF",
            primary_button: "#10B981",
            secondary_button: "#3B82F6",
            text_color: "#1F2937",
            school_year: "2025@ZAMBRIE BIN MOHAMMED",
            school_name: "SK BUKIT CERMIN",
            main_title: "Bahasa Melayu Pemulihan Khas ( Asas 2 )",
            topic_1: "Senarai Perkataan",
            topic_2: "Frasa 2 Perkataan",
            topic_3: "Drag & Drop",
            topic_4: "Suku Kata",
            font_family: "system-ui",
            font_size: 16
        };

        let config = { ...defaultConfig };
        let currentView = 'menu';
        let checkedWords = [];

        const wordsList1 = ["baru", "feri", "juri", "muda", "ragi", "visa", "zoro", "layu", "catu", "guli", "kota", "nona", "soya", "wali", "keju", "paru", "dadu", "hama", "laju", "paku", "tuba", "yoyo", "piza", "tari"];
        const wordsList2 = ["kaki lima", "huru-hara", "hati muda", "roti kaya", "lari laju", "baju bayi", "kuku kaki", "raja muda", "batu-bata", "susu soya", "cili padi", "kopi susu", "kota raya", "buku nota", "hati kama", "ratu hati"];
        
        const dragDropItems = [
            { id: "topi", word: "topi", svg: '<svg viewBox="0 0 120 120" width="110" height="110"><ellipse cx="62" cy="92" rx="38" ry="6" fill="#000" opacity="0.2"/><ellipse cx="60" cy="72" rx="42" ry="10" fill="#654321"/><rect x="18" y="72" width="84" height="8" rx="4" fill="#654321"/><path d="M 60 35 Q 28 40 22 72 L 98 72 Q 92 40 60 35 Z" fill="#A0522D"/><ellipse cx="60" cy="35" rx="18" ry="10" fill="#CD853F"/><ellipse cx="58" cy="33" rx="14" ry="7" fill="#DEB887"/></svg>' },
            { id: "buku", word: "buku", svg: '<svg viewBox="0 0 120 120" width="110" height="110"><ellipse cx="62" cy="88" rx="32" ry="6" fill="#000" opacity="0.2"/><rect x="32" y="35" width="48" height="48" rx="3" fill="#DC143C"/><rect x="35" y="38" width="42" height="42" fill="#FFF"/><line x1="56" y1="38" x2="56" y2="80" stroke="#DC143C" stroke-width="2"/><line x1="40" y1="45" x2="52" y2="45" stroke="#DC143C" stroke-width="2"/><line x1="40" y1="52" x2="52" y2="52" stroke="#DC143C" stroke-width="2"/><line x1="40" y1="59" x2="50" y2="59" stroke="#DC143C" stroke-width="2"/><line x1="60" y1="45" x2="72" y2="45" stroke="#DC143C" stroke-width="2"/><line x1="60" y1="52" x2="72" y2="52" stroke="#DC143C" stroke-width="2"/><line x1="60" y1="59" x2="70" y2="59" stroke="#DC143C" stroke-width="2"/></svg>' },
            { id: "meja", word: "meja", svg: '<svg viewBox="0 0 120 120" width="110" height="110"><ellipse cx="60" cy="92" rx="48" ry="6" fill="#000" opacity="0.2"/><rect x="20" y="78" width="10" height="20" fill="#8B4513"/><rect x="90" y="78" width="10" height="20" fill="#8B4513"/><rect x="15" y="60" width="90" height="20" rx="3" fill="#D2691E"/><rect x="15" y="58" width="90" height="16" rx="3" fill="#DEB887"/></svg>' },
            { id: "bola", word: "bola", svg: '<svg viewBox="0 0 120 120" width="110" height="110"><defs><radialGradient id="bolaGrad"><stop offset="20%" style="stop-color:#FFF;stop-opacity:1" /><stop offset="60%" style="stop-color:#FF4500;stop-opacity:1" /><stop offset="100%" style="stop-color:#CC0000;stop-opacity:1" /></radialGradient></defs><ellipse cx="64" cy="88" rx="28" ry="6" fill="#000" opacity="0.25"/><circle cx="60" cy="60" r="32" fill="url(#bolaGrad)"/><path d="M 60 32 L 55 50 L 45 48 L 48 62 L 38 58" stroke="#000" stroke-width="3" fill="none"/><path d="M 60 32 L 65 50 L 75 48 L 72 62 L 82 58" stroke="#000" stroke-width="3" fill="none"/><path d="M 38 58 L 42 72 L 60 88" stroke="#000" stroke-width="3" fill="none"/><path d="M 82 58 L 78 72 L 60 88" stroke="#000" stroke-width="3" fill="none"/></svg>' },
            { id: "baju", word: "baju", svg: '<svg viewBox="0 0 120 120" width="110" height="110"><ellipse cx="60" cy="94" rx="35" ry="6" fill="#000" opacity="0.2"/><circle cx="60" cy="38" r="8" fill="#FFD4A3"/><rect x="46" y="46" width="28" height="42" rx="3" fill="#4169E1"/><path d="M 46 50 L 34 58 L 34 72 L 46 68 Z" fill="#5B8EF5"/><path d="M 74 50 L 86 58 L 86 72 L 74 68 Z" fill="#5B8EF5"/><circle cx="60" cy="56" r="2.5" fill="#FFF"/><circle cx="60" cy="64" r="2.5" fill="#FFF"/><circle cx="60" cy="72" r="2.5" fill="#FFF"/><circle cx="60" cy="80" r="2.5" fill="#FFF"/></svg>' }
        ];

        const syllableItems = [
            { id: "meja", word: "meja", show: "me", missing: "ja", svg: '<svg viewBox="0 0 120 120" width="100" height="100"><ellipse cx="60" cy="92" rx="48" ry="6" fill="#000" opacity="0.2"/><rect x="20" y="78" width="10" height="20" fill="#8B4513"/><rect x="90" y="78" width="10" height="20" fill="#8B4513"/><rect x="15" y="60" width="90" height="20" rx="3" fill="#D2691E"/><rect x="15" y="58" width="90" height="16" rx="3" fill="#DEB887"/></svg>' },
            { id: "feri", word: "feri", show: "fe", missing: "ri", svg: '<svg viewBox="0 0 120 120" width="100" height="100"><ellipse cx="65" cy="95" rx="45" ry="6" fill="#000" opacity="0.2"/><path d="M 25 70 L 95 70 L 90 85 L 30 85 Z" fill="#4169E1"/><rect x="35" y="50" width="50" height="20" rx="2" fill="#5B8EF5"/><rect x="40" y="55" width="8" height="10" fill="#87CEEB"/><rect x="52" y="55" width="8" height="10" fill="#87CEEB"/><rect x="64" y="55" width="8" height="10" fill="#87CEEB"/><rect x="76" y="55" width="8" height="10" fill="#87CEEB"/><rect x="55" y="35" width="10" height="15" fill="#DC143C"/><path d="M 55 35 L 55 25 L 75 32 Z" fill="#DC143C"/></svg>' },
            { id: "batu", word: "batu", show: "ba", missing: "tu", svg: '<svg viewBox="0 0 120 120" width="100" height="100"><ellipse cx="60" cy="95" rx="40" ry="6" fill="#000" opacity="0.2"/><ellipse cx="60" cy="65" rx="35" ry="28" fill="#808080"/><ellipse cx="55" cy="60" rx="32" ry="25" fill="#A9A9A9"/><ellipse cx="50" cy="58" rx="10" ry="8" fill="#696969" opacity="0.4"/><ellipse cx="65" cy="70" rx="8" ry="6" fill="#696969" opacity="0.4"/></svg>' },
            { id: "topi", word: "topi", show: "to", missing: "pi", svg: '<svg viewBox="0 0 120 120" width="100" height="100"><ellipse cx="62" cy="92" rx="38" ry="6" fill="#000" opacity="0.2"/><ellipse cx="60" cy="72" rx="42" ry="10" fill="#654321"/><rect x="18" y="72" width="84" height="8" rx="4" fill="#654321"/><path d="M 60 35 Q 28 40 22 72 L 98 72 Q 92 40 60 35 Z" fill="#A0522D"/><ellipse cx="60" cy="35" rx="18" ry="10" fill="#CD853F"/><ellipse cx="58" cy="33" rx="14" ry="7" fill="#DEB887"/></svg>' },
            { id: "yoyo", word: "yoyo", show: "yo", missing: "yo", svg: '<svg viewBox="0 0 120 120" width="100" height="100"><ellipse cx="60" cy="95" rx="28" ry="5" fill="#000" opacity="0.2"/><line x1="60" y1="25" x2="60" y2="50" stroke="#666" stroke-width="2"/><circle cx="60" cy="60" r="20" fill="#DC143C"/><circle cx="60" cy="60" r="17" fill="#FF6B6B"/><circle cx="60" cy="60" r="8" fill="#FFD700"/><circle cx="60" cy="60" r="5" fill="#FFF"/></svg>' },
            { id: "tiga", word: "tiga", show: "ti", missing: "ga", svg: '<svg viewBox="0 0 120 120" width="100" height="100"><ellipse cx="60" cy="90" rx="25" ry="5" fill="#000" opacity="0.2"/><text x="60" y="70" font-family="Arial Black" font-size="55" font-weight="bold" fill="#4169E1" text-anchor="middle">3</text></svg>' }
        ];

        let words = [];
        let currentList = 1;
        let startTime = null;
        let elapsedTime = 0;
        let timerInterval = null;

        // Drag and drop state
        let draggedWord = null;
        let currentDragItems = [];
        let availableWords = [];
        let attempts = {};
        let completedItems = [];

        // Syllables state
        let currentSyllableItems = [];
        let availableSyllables = [];
        let syllableAttempts = {};
        let completedSyllables = [];

        function startTimer() {
            startTime = Date.now() - elapsedTime;
            timerInterval = setInterval(() => {
                elapsedTime = Date.now() - startTime;
                updateTimerDisplay();
            }, 100);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function resetTimer() {
            stopTimer();
            elapsedTime = 0;
            startTime = null;
        }

        function updateTimerDisplay() {
            const timerElement = document.getElementById('timer-display');
            if (timerElement) {
                const seconds = Math.floor(elapsedTime / 1000);
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
            }
        }

        function formatTime(ms) {
            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function renderApp() {
            const app = document.getElementById('app');
            const baseSize = config.font_size || defaultConfig.font_size;
            const customFont = config.font_family || defaultConfig.font_family;
            const fontStack = `${customFont}, system-ui, -apple-system, sans-serif`;

            if (currentView === 'menu') {
                app.innerHTML = `
                    <div class="w-full min-h-full p-6" style="background-color: ${config.background_color || defaultConfig.background_color}; font-family: ${fontStack};">
                        <div class="max-w-4xl mx-auto">
                            <div class="text-center mb-8 fade-in">
                                <div id="school-year" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseSize * 1.1}px; font-weight: 600; margin-bottom: 8px;">
                                    ${config.school_year || defaultConfig.school_year}
                                </div>
                                <div id="school-name" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseSize * 1.3}px; font-weight: 700; margin-bottom: 16px;">
                                    ${config.school_name || defaultConfig.school_name}
                                </div>
                                <div id="main-title" style="color: ${config.primary_button || defaultConfig.primary_button}; font-size: ${baseSize * 1.5}px; font-weight: 800;">
                                    ${config.main_title || defaultConfig.main_title}
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 max-w-6xl mx-auto">
                                <button onclick="startChecklist(1)" class="topic-button p-8 rounded-2xl shadow-lg transition-all duration-300 hover:shadow-2xl hover:scale-105 fade-in" style="background-color: ${config.card_color || defaultConfig.card_color}; border: 4px solid ${config.primary_button || defaultConfig.primary_button};">
                                    <div style="font-size: ${baseSize * 3}px; margin-bottom: 16px;">üìñ</div>
                                    <div id="topic-1-title" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseSize * 1.2}px; font-weight: 700;">
                                        ${config.topic_1 || defaultConfig.topic_1}
                                    </div>
                                    <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseSize * 0.9}px; margin-top: 8px; opacity: 0.7;">
                                        24 Perkataan
                                    </div>
                                </button>
                                <button onclick="startChecklist(2)" class="topic-button p-8 rounded-2xl shadow-lg transition-all duration-300 hover:shadow-2xl hover:scale-105 fade-in" style="background-color: ${config.card_color || defaultConfig.card_color}; border: 4px solid ${config.secondary_button || defaultConfig.secondary_button};">
                                    <div style="font-size: ${baseSize * 3}px; margin-bottom: 16px;">üìö</div>
                                    <div id="topic-2-title" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseSize * 1.2}px; font-weight: 700;">
                                        ${config.topic_2 || defaultConfig.topic_2}
                                    </div>
                                    <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseSize * 0.9}px; margin-top: 8px; opacity: 0.7;">
                                        16 Frasa
                                    </div>
                                </button>
                                <button onclick="startDragDrop()" class="topic-button p-8 rounded-2xl shadow-lg transition-all duration-300 hover:shadow-2xl hover:scale-105 fade-in" style="background-color: ${config.card_color || defaultConfig.card_color}; border: 4px solid #F59E0B;">
                                    <div style="font-size: ${baseSize * 3}px; margin-bottom: 16px;">üéØ</div>
                                    <div id="topic-3-title" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseSize * 1.2}px; font-weight: 700;">
                                        ${config.topic_3 || defaultConfig.topic_3}
                                    </div>
                                    <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseSize * 0.9}px; margin-top: 8px; opacity: 0.7;">
                                        5 Gambar
                                    </div>
                                </button>
                                <button onclick="startSyllables()" class="topic-button p-8 rounded-2xl shadow-lg transition-all duration-300 hover:shadow-2xl hover:scale-105 fade-in" style="background-color: ${config.card_color || defaultConfig.card_color}; border: 4px solid #8B5CF6;">
                                    <div style="font-size: ${baseSize * 3}px; margin-bottom: 16px;">üß©</div>
                                    <div id="topic-4-title" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseSize * 1.2}px; font-weight: 700;">
                                        ${config.topic_4 || defaultConfig.topic_4}
                                    </div>
                                    <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseSize * 0.9}px; margin-top: 8px; opacity: 0.7;">
                                        6 Perkataan
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentView === 'checklist') {
                const checkedCount = checkedWords.length;
                const totalWords = words.length;
                const primaryColor = config.primary_button || defaultConfig.primary_button;
                
                app.innerHTML = `
                    <div class="w-full min-h-full p-6" style="background-color: ${config.background_color || defaultConfig.background_color}; font-family: ${fontStack};">
                        <div class="max-w-4xl mx-auto">
                            <div class="mb-6 slide-in">
                                <div class="flex items-center justify-between mb-4">
                                    <button onclick="backToMenu()" class="px-6 py-3 rounded-xl font-bold transition-all duration-300 hover:scale-105" style="background-color: ${config.card_color || defaultConfig.card_color}; color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseSize}px; border: 2px solid ${primaryColor};">
                                        ‚Üê Kembali
                                    </button>
                                    <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseSize * 1.1}px; font-weight: 600;">
                                        ${checkedCount}/${totalWords} kata
                                    </div>
                                </div>
                                <div class="text-center p-4 rounded-xl" style="background-color: ${config.card_color || defaultConfig.card_color}; border: 3px solid ${primaryColor};">
                                    <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseSize * 0.9}px; margin-bottom: 4px;">‚è±Ô∏è Masa</div>
                                    <div id="timer-display" style="color: ${primaryColor}; font-size: ${baseSize * 2}px; font-weight: 700;">${formatTime(elapsedTime)}</div>
                                </div>
                            </div>

                            <div class="p-8 rounded-2xl shadow-xl mb-6 fade-in" style="background-color: ${config.card_color || defaultConfig.card_color}; border-top: 6px solid ${primaryColor};">
                                <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseSize * 1.4}px; font-weight: 700; margin-bottom: 24px;">
                                    Tandakan jika murid boleh membaca dengan baik
                                </div>

                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                    ${words.map((word, index) => {
                                        const isChecked = checkedWords.includes(index);
                                        
                                        let displayContent;
                                        if (currentList === 2) {
                                            const wordsInPhrase = word.split(' ');
                                            const coloredWords = wordsInPhrase.map(w => {
                                                if (w.length <= 2) {
                                                    return `<span style="color: ${isChecked ? 'white' : config.text_color || defaultConfig.text_color};">${w}</span>`;
                                                } else if (w.length === 3) {
                                                    const first2 = w.slice(0, 2);
                                                    const last1 = w.slice(-1);
                                                    return `<span style="color: ${isChecked ? 'white' : config.text_color || defaultConfig.text_color};">${first2}</span><span style="color: ${isChecked ? 'white' : '#EF4444'};">${last1}</span>`;
                                                } else if (w.length === 4) {
                                                    const first2 = w.slice(0, 2);
                                                    const last2 = w.slice(-2);
                                                    return `<span style="color: ${isChecked ? 'white' : config.text_color || defaultConfig.text_color};">${first2}</span><span style="color: ${isChecked ? 'white' : '#EF4444'};">${last2}</span>`;
                                                } else {
                                                    const first2 = w.slice(0, 2);
                                                    const middle = w.slice(2, -2);
                                                    const last2 = w.slice(-2);
                                                    return `<span style="color: ${isChecked ? 'white' : config.text_color || defaultConfig.text_color};">${first2}</span><span style="color: ${isChecked ? 'white' : config.text_color || defaultConfig.text_color};">${middle}</span><span style="color: ${isChecked ? 'white' : '#EF4444'};">${last2}</span>`;
                                                }
                                            }).join(' ');
                                            displayContent = `${isChecked ? '<span style="color: white;">‚úì </span>' : ''}${coloredWords}`;
                                        } else {
                                            const firstPart = word.slice(0, -2);
                                            const lastTwo = word.slice(-2);
                                            displayContent = `<span style="color: ${isChecked ? 'white' : config.text_color || defaultConfig.text_color};">${isChecked ? '‚úì ' : ''}${firstPart}</span><span style="color: ${isChecked ? 'white' : '#EF4444'};">${lastTwo}</span>`;
                                        }
                                        
                                        return `
                                            <button onclick="toggleWord(${index})" class="p-8 rounded-xl font-bold transition-all duration-300 hover:scale-105 shadow-md" style="background-color: ${isChecked ? primaryColor : config.background_color || defaultConfig.background_color}; font-size: ${baseSize * 2.5}px; border: 4px solid ${primaryColor};">
                                                ${displayContent}
                                            </button>
                                        `;
                                    }).join('')}
                                </div>
                            </div>

                            <div class="text-center" style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseSize * 1.2}px; font-weight: 600;">
                                Kemajuan: <span style="color: ${primaryColor}; font-weight: 700; font-size: ${baseSize * 1.5}px;">${Math.round((checkedCount/totalWords)*100)}%</span>
                            </div>
                        </div>
                    </div>
                `;
            } else if (currentView === 'dragdrop') {
                const primaryColor = config.primary_button || defaultConfig.primary_button;
                
                app.innerHTML = `
                    <div class="w-full min-h-full p-6" style="background-color: ${config.background_color || defaultConfig.background_color}; font-family: ${fontStack};">
                        <div class="max-w-6xl mx-auto">
                            <div class="mb-6 slide-in">
                                <div class="flex items-center justify-between mb-4">
                                    <button onclick="backToMenu()" class="px-6 py-3 rounded-xl font-bold transition-all duration-300 hover:scale-105" style="background-color: ${config.card_color || defaultConfig.card_color}; color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseSize}px; border: 2px solid ${primaryColor};">
                                        ‚Üê Kembali
                                    </button>
                                    <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseSize * 1.1}px; font-weight: 600;">
                                        ${completedItems.length}/5 selesai
                                    </div>
                                </div>
                            </div>

                            <div class="p-8 rounded-2xl shadow-xl mb-6 fade-in" style="background-color: ${config.card_color || defaultConfig.card_color}; border-top: 6px solid #F59E0B;">
                                <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseSize * 1.4}px; font-weight: 700; margin-bottom: 16px; text-align: center;">
                                    Seret perkataan ke gambar yang betul
                                </div>

                                <!-- Drop Zones (Images) -->
                                <div class="grid grid-cols-5 gap-4 mb-8">
                                    ${currentDragItems.map(item => {
                                        const isCompleted = completedItems.includes(item.id);
                                        const attemptCount = attempts[item.id] || 0;
                                        return `
                                            <div class="drop-zone" data-drop-id="${item.id}" style="background-color: ${isCompleted ? '#10B981' : config.background_color || defaultConfig.background_color}; padding: 16px; border-radius: 12px; border: 4px dashed ${isCompleted ? '#10B981' : '#D1D5DB'}; text-align: center; transition: all 0.3s; ${isCompleted ? 'opacity: 0.6; pointer-events: none;' : ''}">
                                                <div style="margin-bottom: 8px;">${item.svg}</div>
                                                <div style="color: ${isCompleted ? 'white' : config.text_color || defaultConfig.text_color}; font-size: ${baseSize * 0.9}px; font-weight: 600; margin-top: 8px;">
                                                    ${isCompleted ? '‚úì ' + item.word : '?'}
                                                </div>
                                                ${!isCompleted && attemptCount > 0 ? `<div style="color: #EF4444; font-size: ${baseSize * 0.8}px; margin-top: 4px;">‚ùå ${attemptCount}/2</div>` : ''}
                                            </div>
                                        `;
                                    }).join('')}
                                </div>

                                <!-- Draggable Words -->
                                <div style="background-color: ${config.background_color || defaultConfig.background_color}; padding: 24px; border-radius: 12px; border: 3px solid #F59E0B;">
                                    <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseSize}px; font-weight: 600; margin-bottom: 12px; text-align: center;">
                                        Perkataan-perkataan:
                                    </div>
                                    <div class="grid grid-cols-5 gap-4">
                                        ${availableWords.map(word => `
                                            <div class="draggable-word" draggable="true" data-word="${word}" style="background-color: ${config.card_color || defaultConfig.card_color}; padding: 16px 12px; border-radius: 8px; border: 3px solid #F59E0B; text-align: center; cursor: move; transition: all 0.3s; font-size: ${baseSize * 1.2}px; font-weight: 700; color: ${config.text_color || defaultConfig.text_color};">
                                                ${word}
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>

                            ${completedItems.length === 5 ? `
                                <div class="text-center p-6 rounded-xl fade-in" style="background-color: #10B981; color: white;">
                                    <div style="font-size: ${baseSize * 2}px; margin-bottom: 8px;">üéâ</div>
                                    <div style="font-size: ${baseSize * 1.5}px; font-weight: 700;">Tahniah! Semua betul!</div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;

                setupDragAndDrop();
            } else if (currentView === 'syllables') {
                const primaryColor = config.primary_button || defaultConfig.primary_button;
                
                app.innerHTML = `
                    <div class="w-full min-h-full p-6" style="background-color: ${config.background_color || defaultConfig.background_color}; font-family: ${fontStack};">
                        <div class="max-w-6xl mx-auto">
                            <div class="mb-6 slide-in">
                                <div class="flex items-center justify-between mb-4">
                                    <button onclick="backToMenu()" class="px-6 py-3 rounded-xl font-bold transition-all duration-300 hover:scale-105" style="background-color: ${config.card_color || defaultConfig.card_color}; color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseSize}px; border: 2px solid ${primaryColor};">
                                        ‚Üê Kembali
                                    </button>
                                    <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseSize * 1.1}px; font-weight: 600;">
                                        ${completedSyllables.length}/6 selesai
                                    </div>
                                </div>
                            </div>

                            <div class="p-8 rounded-2xl shadow-xl mb-6 fade-in" style="background-color: ${config.card_color || defaultConfig.card_color}; border-top: 6px solid #8B5CF6;">
                                <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseSize * 1.4}px; font-weight: 700; margin-bottom: 16px; text-align: center;">
                                    Carikan suku kata yang tertinggal
                                </div>

                                <!-- Draggable Syllables -->
                                <div style="background-color: ${config.background_color || defaultConfig.background_color}; padding: 24px; border-radius: 12px; border: 3px solid #8B5CF6; margin-bottom: 24px;">
                                    <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseSize}px; font-weight: 600; margin-bottom: 12px; text-align: center;">
                                        Suku kata:
                                    </div>
                                    <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 12px;">
                                        ${availableSyllables.map(syllable => `
                                            <div class="draggable-syllable" draggable="true" data-syllable="${syllable}" style="background-color: ${config.card_color || defaultConfig.card_color}; padding: 12px 24px; border-radius: 8px; border: 3px solid #8B5CF6; text-align: center; cursor: move; transition: all 0.3s; font-size: ${baseSize * 1.5}px; font-weight: 700; color: ${config.text_color || defaultConfig.text_color}; min-width: 70px;">
                                                ${syllable}
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>

                                <!-- Syllable Items -->
                                <div class="grid grid-cols-2 md:grid-cols-3 gap-6 mb-8">
                                    ${currentSyllableItems.map(item => {
                                        const isCompleted = completedSyllables.includes(item.id);
                                        const attemptCount = syllableAttempts[item.id] || 0;
                                        return `
                                            <div class="syllable-drop-zone" data-syllable-id="${item.id}" style="background-color: ${isCompleted ? '#10B981' : config.background_color || defaultConfig.background_color}; padding: 20px; border-radius: 12px; border: 4px dashed ${isCompleted ? '#10B981' : '#8B5CF6'}; text-align: center; transition: all 0.3s; ${isCompleted ? 'opacity: 0.7; pointer-events: none;' : ''}">
                                                <div style="margin-bottom: 12px;">${item.svg}</div>
                                                <div style="display: flex; justify-content: center; align-items: center; gap: 8px; margin-top: 12px;">
                                                    <div style="color: ${config.text_color || defaultConfig.text_color}; font-size: ${baseSize * 1.8}px; font-weight: 700; padding: 10px 18px; border-radius: 8px; border: 3px solid ${isCompleted ? '#10B981' : '#8B5CF6'}; ${isCompleted ? 'background-color: #10B981; color: white;' : ''}">
                                                        ${item.show}
                                                    </div>
                                                    <div style="min-width: 70px; min-height: 52px; color: ${isCompleted ? 'white' : '#999'}; font-size: ${baseSize * 1.8}px; font-weight: 700; background-color: ${isCompleted ? '#10B981' : config.card_color || defaultConfig.card_color}; padding: 10px 18px; border-radius: 8px; border: 3px dashed ${isCompleted ? '#10B981' : '#8B5CF6'}; display: flex; align-items: center; justify-content: center;">
                                                        ${isCompleted ? item.missing : '?'}
                                                    </div>
                                                </div>
                                                ${!isCompleted && attemptCount > 0 ? `<div style="color: #EF4444; font-size: ${baseSize * 0.8}px; margin-top: 8px;">‚ùå ${attemptCount}/2</div>` : ''}
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>

                            ${completedSyllables.length === 6 ? `
                                <div class="text-center p-6 rounded-xl fade-in" style="background-color: #10B981; color: white;">
                                    <div style="font-size: ${baseSize * 2}px; margin-bottom: 8px;">üéâ</div>
                                    <div style="font-size: ${baseSize * 1.5}px; font-weight: 700;">Tahniah! Semua betul!</div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;

                setupSyllableDragDrop();
            }
        }

        function setupDragAndDrop() {
            const draggables = document.querySelectorAll('.draggable-word');
            const dropZones = document.querySelectorAll('.drop-zone');

            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', handleDragStart);
                draggable.addEventListener('dragend', handleDragEnd);
            });

            dropZones.forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('dragleave', handleDragLeave);
                zone.addEventListener('drop', handleDrop);
            });
        }

        function handleDragStart(e) {
            draggedWord = e.target.dataset.word;
            e.target.classList.add('dragging');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            const dropId = e.currentTarget.dataset.dropId;
            
            if (completedItems.includes(dropId)) {
                return;
            }

            const correctWord = currentDragItems.find(item => item.id === dropId).word;
            
            if (draggedWord === correctWord) {
                e.currentTarget.classList.add('correct-drop');
                completedItems.push(dropId);
                availableWords = availableWords.filter(w => w !== draggedWord);
                setTimeout(() => {
                    renderApp();
                }, 500);
            } else {
                e.currentTarget.classList.add('wrong-drop');
                attempts[dropId] = (attempts[dropId] || 0) + 1;
                
                setTimeout(() => {
                    e.currentTarget.classList.remove('wrong-drop');
                    
                    if (attempts[dropId] >= 2) {
                        reshuffleQuestion(dropId);
                    } else {
                        renderApp();
                    }
                }, 500);
            }
        }

        function reshuffleQuestion(failedId) {
            const failedItem = currentDragItems.find(item => item.id === failedId);
            const remainingItems = dragDropItems.filter(item => 
                !completedItems.includes(item.id) && item.id !== failedId
            );
            
            if (remainingItems.length > 0) {
                const randomItem = remainingItems[Math.floor(Math.random() * remainingItems.length)];
                const index = currentDragItems.findIndex(item => item.id === failedId);
                currentDragItems[index] = randomItem;
                
                availableWords = availableWords.filter(w => w !== failedItem.word);
                availableWords.push(randomItem.word);
                availableWords = shuffleArray(availableWords);
                
                attempts[failedId] = 0;
            }
            
            renderApp();
        }

        function startChecklist(listNumber) {
            currentList = listNumber;
            currentView = 'checklist';
            checkedWords = [];
            
            if (listNumber === 1) {
                words = [...wordsList1];
            } else {
                words = [...wordsList2];
            }
            
            resetTimer();
            startTimer();
            renderApp();
        }

        function startDragDrop() {
            currentView = 'dragdrop';
            currentDragItems = shuffleArray([...dragDropItems]);
            availableWords = shuffleArray(currentDragItems.map(item => item.word));
            attempts = {};
            completedItems = [];
            renderApp();
        }

        function startSyllables() {
            currentView = 'syllables';
            currentSyllableItems = shuffleArray([...syllableItems]);
            availableSyllables = shuffleArray(currentSyllableItems.map(item => item.missing));
            syllableAttempts = {};
            completedSyllables = [];
            renderApp();
        }

        function setupSyllableDragDrop() {
            const draggables = document.querySelectorAll('.draggable-syllable');
            const dropZones = document.querySelectorAll('.syllable-drop-zone');

            draggables.forEach(draggable => {
                draggable.addEventListener('dragstart', handleSyllableDragStart);
                draggable.addEventListener('dragend', handleSyllableDragEnd);
            });

            dropZones.forEach(zone => {
                zone.addEventListener('dragover', handleSyllableDragOver);
                zone.addEventListener('dragleave', handleSyllableDragLeave);
                zone.addEventListener('drop', handleSyllableDrop);
            });
        }

        function handleSyllableDragStart(e) {
            draggedWord = e.target.dataset.syllable;
            e.target.classList.add('dragging');
        }

        function handleSyllableDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleSyllableDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function handleSyllableDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleSyllableDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            const syllableId = e.currentTarget.dataset.syllableId;
            
            if (completedSyllables.includes(syllableId)) {
                return;
            }

            const correctSyllable = currentSyllableItems.find(item => item.id === syllableId).missing;
            
            if (draggedWord === correctSyllable) {
                e.currentTarget.classList.add('correct-drop');
                completedSyllables.push(syllableId);
                availableSyllables = availableSyllables.filter(s => s !== draggedWord);
                setTimeout(() => {
                    renderApp();
                }, 500);
            } else {
                e.currentTarget.classList.add('wrong-drop');
                syllableAttempts[syllableId] = (syllableAttempts[syllableId] || 0) + 1;
                
                setTimeout(() => {
                    e.currentTarget.classList.remove('wrong-drop');
                    
                    if (syllableAttempts[syllableId] >= 2) {
                        reshuffleSyllable(syllableId);
                    } else {
                        renderApp();
                    }
                }, 500);
            }
        }

        function reshuffleSyllable(failedId) {
            const failedItem = currentSyllableItems.find(item => item.id === failedId);
            const remainingItems = syllableItems.filter(item => 
                !completedSyllables.includes(item.id) && item.id !== failedId
            );
            
            if (remainingItems.length > 0) {
                const randomItem = remainingItems[Math.floor(Math.random() * remainingItems.length)];
                const index = currentSyllableItems.findIndex(item => item.id === failedId);
                currentSyllableItems[index] = randomItem;
                
                availableSyllables = availableSyllables.filter(s => s !== failedItem.missing);
                availableSyllables.push(randomItem.missing);
                availableSyllables = shuffleArray(availableSyllables);
                
                syllableAttempts[failedId] = 0;
            }
            
            renderApp();
        }

        function toggleWord(wordIndex) {
            const checkedIndex = checkedWords.indexOf(wordIndex);
            
            if (checkedIndex > -1) {
                checkedWords.splice(checkedIndex, 1);
            } else {
                checkedWords.push(wordIndex);
            }
            
            if (checkedWords.length === words.length) {
                stopTimer();
            }
            
            renderApp();
        }

        function backToMenu() {
            stopTimer();
            currentView = 'menu';
            renderApp();
        }

        async function onConfigChange(newConfig) {
            Object.assign(config, newConfig);
            renderApp();
        }

        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                onConfigChange,
                mapToCapabilities: (config) => ({
                    recolorables: [
                        {
                            get: () => config.background_color || defaultConfig.background_color,
                            set: (value) => {
                                config.background_color = value;
                                window.elementSdk.setConfig({ background_color: value });
                            }
                        },
                        {
                            get: () => config.card_color || defaultConfig.card_color,
                            set: (value) => {
                                config.card_color = value;
                                window.elementSdk.setConfig({ card_color: value });
                            }
                        },
                        {
                            get: () => config.text_color || defaultConfig.text_color,
                            set: (value) => {
                                config.text_color = value;
                                window.elementSdk.setConfig({ text_color: value });
                            }
                        },
                        {
                            get: () => config.primary_button || defaultConfig.primary_button,
                            set: (value) => {
                                config.primary_button = value;
                                window.elementSdk.setConfig({ primary_button: value });
                            }
                        },
                        {
                            get: () => config.secondary_button || defaultConfig.secondary_button,
                            set: (value) => {
                                config.secondary_button = value;
                                window.elementSdk.setConfig({ secondary_button: value });
                            }
                        }
                    ],
                    borderables: [],
                    fontEditable: {
                        get: () => config.font_family || defaultConfig.font_family,
                        set: (value) => {
                            config.font_family = value;
                            window.elementSdk.setConfig({ font_family: value });
                        }
                    },
                    fontSizeable: {
                        get: () => config.font_size || defaultConfig.font_size,
                        set: (value) => {
                            config.font_size = value;
                            window.elementSdk.setConfig({ font_size: value });
                        }
                    }
                }),
                mapToEditPanelValues: (config) => new Map([
                    ["school_year", config.school_year || defaultConfig.school_year],
                    ["school_name", config.school_name || defaultConfig.school_name],
                    ["main_title", config.main_title || defaultConfig.main_title],
                    ["topic_1", config.topic_1 || defaultConfig.topic_1],
                    ["topic_2", config.topic_2 || defaultConfig.topic_2],
                    ["topic_3", config.topic_3 || defaultConfig.topic_3],
                    ["topic_4", config.topic_4 || defaultConfig.topic_4]
                ])
            });
        }

        renderApp();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a7fed76766d7a7f',t:'MTc2NDczMjAyMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>